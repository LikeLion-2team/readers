<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.readers.repository.MainDAO">

	<select id="getHotBoard" resultType="BoardDTO" parameterType="Integer">
	SELECT
			BOARD.BOARD_NUM
			,BOARD.CAT_DOMAIN
			,BOARD.CREATOR
			,BOARD.TITLE
			,BOARD.CONTENT
			,BOARD.HIT
			,BOARD.CRT_TM
	FROM
			TB_BOARD BOARD
	ORDER BY 
			CRT_TM DESC
	FETCH FIRST #{mainViewImg}
	ROWS ONLY
	</select>
	
	<select id="getHotGallery" resultType="GalleryDTO" parameterType="Integer">
	SELECT
			GALLERY.GALLERY_NUM
			,GALLERY.CAT_DOMAIN
			,GALLERY.TITLE
			,GALLERY.AUTHOR
			,GALLERY.PUBLISHER
			,GALLERY.CREATOR
			,GALLERY.CRT_TM
			,GALLERY.GOOD_CNT
	FROM
			TB_GALLERY GALLERY
	INNER JOIN 
			TB_POINT POINT
	ON
			GALLERY.GALLERY_NUM=POINT.GALLERY_NUM
	ORDER BY 
			CRT_TM DESC
	FETCH FIRST #{mainViewImg}
	ROWS ONLY
	</select>
	
	<select id="checkGuest" parameterType="Integer" resultType="Integer">
	SELECT
			VISITOR.IP
	FROM
			TB_VISITOR VISITOR
	WHERE
			VISITOR.IP = #{guestIp}
	</select>
	
	<select id="getLastVisitTime" parameterType="String" resultType="LastVisiteDTO">
	SELECT
			VISITOR.IP
			VISITOR.VISITE_TM
	FROM
			TB_VISITOR VISITOR
	WHERE
			VISITOR.IP = #{guestIp}
	</select>
	
	
	<insert id="insertVisitor" parameterType="String" >
	INSERT INTO
			TB_VISITOR
			(
			VISITOR_NUM
			,IP
			)
	VALUES
			(
			VISITE.NEXTVAL
			,#{guestIp}
			)
	</insert>
	
	<update id="countPlusVisist" parameterType="String">
	UPDATE
			TB_VISITOR
	SET
			VISITE_HIT = VISITE_HIT + 1
	WHERE
			IP = #{guestIp}
	</update>
	
	<select id="getTotalVisiteCount" resultType="Integer">
	SELECT
			COUNT(VISITOR_NUM)
	FROM
			TB_VISITOR VISITOR
	</select>
	
	<select id="getDayVisiteCount" resultType="Integer" parameterType="LocalDateTime">
	SELECT
			COUNT(VISITOR_NUM)
	FROM
			TB_VISITOR VISITOR
	WHERE
			TO_DATE(VISITE_TM,'YYYY-MM-DD') = TO_DATE(#{nowTime},'YYYY-MM-DD')
	</select>
	
	<select id="getWeekVisiteCount"  parameterType="String" resultType="VisiitorCountDTO">
	SELECT
			TO_DATE(VISITE_TM, 'YYYY-MM-DD')AS DAY
			COUNT(VISITOR_NUM) AS VISITOR_COUNT
	FROM
			TB VISITOR VISITOR
	WHERE
			TO_DATE(VISITE_TM, 'YYYY-MM-DD')
	BETWEEN 
			TO_DATE(#{nowTime}, 'YYYY-MM-DD')
	AND 
			TO_DATE(#{nowTime}-6, 'YYYY-MM-DD')
	GROUP BY
			TO_DATE(VISITE_TM, 'YYYY-MM-DD')
	ORDER BY
			TO_DATE(VISITE_TM, 'YYYY-MM-DD')
	</select>
</mapper>